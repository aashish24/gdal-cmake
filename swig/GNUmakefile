GDAL_ROOT	=	../..

include ../../GDALmake.opt

PYTHON = python
SWIG = swig
SWIGARGS = -Wall

TYPEMAPDEPS = gdal_typemaps.i typemaps_csharp.i typemaps_python.i typemaps_php.i

PY_COMMANDS	=	epsg_tr.py gdalchksum.py gdal2xyz.py gcps2wld.py \
			gdalimport.py gdal_merge.py pct2rgb.py rgb2pct.py \
			gcps2vec.py
PY_MODULES	=	gdal.py ogr.py osr.py gdalconst.py
PY_WRAPPERS	= 	gdal_python.cpp gdalconst_python.c ogr_python.cpp osr_python.cpp

PHP_MODULES	=	php/gdal.php php/gdalconst.php php/ogr.php php/osr.php
PHP_WRAPPERS	= 	php/gdal_php.cpp php/gdalconst_php.c php/ogr_php.cpp php/osr_php.cpp 
PHP_EXTRADIST	= 	php/php_gdal.h php/php_gdalconst.h php/php_ogr.h php/php_osr.h

# The BINDINGS variable contains a list of the language bindings to be used
# in the default and install targets.  This could be moved to GDALmake.opt
# and generated by the configure script.
BINDINGS = python php

.PHONY: python_build python_install php_build php_install

default: ${BINDINGS:%=%_generate}

install: ${BINDINGS:%=%_install}

# The dist target should generate all the wrapper files for all supported
# language bindings.  This should be called by the top level distribution
# maker script prior to bundling up the source.  It eliminates the installer
# from having the proper version of swig installled.
dist: $(PY_WRAPPERS) $(PHP_WRAPPERS)

clean:
	rm -r build

veryclean:
	-rm -r build 2> /dev/null
	-rm $(PY_WRAPPERS) 2> /dev/null
	-rm $(PY_MODULES) $(PY_MODULES:%.py=%.pyc) 2> /dev/null
	-rm $(PHP_MODULES) $(PHP_WRAPPERS) $(PHP_EXTRADIST) 2> /dev/null

gdal_python.cpp: gdal.i MajorObject.i Driver.i Dataset.i Band.i ColorTable.i cpl.i $(TYPEMAPDEPS)
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ gdal.i 

gdalconst_python.c: gdalconst.i
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -python -o $@ gdalconst.i

ogr_python.cpp:  ogr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ ogr.i 

osr_python.cpp:  osr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ osr.i 

php/gdal_php.cpp: gdal.i MajorObject.i Driver.i Dataset.i Band.i ColorTable.i cpl.i $(TYPEMAPDEPS)
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -php -outdir php -o $@ gdal.i 

php/gdalconst_php.c: gdalconst.i
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -php -outdir php -o $@ gdalconst.i

php/ogr_php.cpp:  ogr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -outdir php -php -o $@ ogr.i 

php/osr_php.cpp:  osr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -outdir php -php -o $@ osr.i 

#
# We delegate the build and install processes to Python's distutils module
# through the setup.py script.  I don't understand how this will interact
# with libtool based builds.  It might have to be changed some in the future.

python_generate: $(PY_WRAPPERS)

python_build: $(PY_WRAPPERS)
	$(PYTHON) setup.py build

python_install: $(PY_WRAPPERS)
	$(PYTHON) setup.py install --prefix=$(prefix)

#
# PHP
php_generate: $(PHP_WRAPPERS)

