GDAL_ROOT	=	..

include ../GDALmake.opt

PYTHON = python
SWIG = swig
SWIGARGS = -Wall

PY_COMMANDS	=	epsg_tr.py gdalchksum.py gdal2xyz.py gcps2wld.py \
			gdalimport.py gdal_merge.py pct2rgb.py rgb2pct.py \
			gcps2vec.py
PY_MODULES	=	python/gdal.py python/ogr.py python/osr.py python/gdalconst.py
PY_WRAPPERS	= 	python/gdal_python.cpp python/gdalconst_python.c python/ogr_python.cpp python/osr_python.cpp

PHP_MODULES	=	php/gdal.php php/gdalconst.php php/ogr.php php/osr.php
PHP_WRAPPERS	= 	php/gdal_php.cpp php/gdalconst_php.c php/ogr_php.cpp php/osr_php.cpp 
PHP_EXTRADIST	= 	php/php_gdal.h php/php_gdalconst.h php/php_ogr.h php/php_osr.h

# The BINDINGS variable contains a list of the language bindings to be used
# in the default and install targets.  This could be moved to GDALmake.opt
# and generated by the configure script.
BINDINGS = python php

.PHONY: python_build python_install php_build php_install

default: ${BINDINGS:%=%_generate}

install: ${BINDINGS:%=%_install}

# The dist target should generate all the wrapper files for all supported
# language bindings.  This should be called by the top level distribution
# maker script prior to bundling up the source.  It eliminates the installer
# from having the proper version of swig installled.
dist: $(PY_WRAPPERS) $(PHP_WRAPPERS)

clean:
	rm -r build

veryclean:
	-rm -r build 2> /dev/null
	-rm $(PY_WRAPPERS) 2> /dev/null
	-rm $(PY_MODULES) $(PY_MODULES:%.py=%.pyc) 2> /dev/null
	-rm $(PHP_MODULES) $(PHP_WRAPPERS) $(PHP_EXTRADIST) 2> /dev/null

python/gdal_python.cpp: include/gdal.i include/MajorObject.i include/Driver.i include/Dataset.i include/Band.i include/ColorTable.i include/cpl.i include/typemaps_python.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -outdir python -python -o $@ gdal.i 

python/gdalconst_python.c: include/gdalconst.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -outdir python -python -o $@ gdalconst.i

python/ogr_python.cpp:  include/ogr.i include/typemaps_python.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -outdir python -python -o $@ ogr.i 

python/osr_python.cpp:  include/osr.i include/typemaps_python.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -outdir python -python -o $@ osr.i 

php/gdal_php.cpp: include/gdal.i include/MajorObject.i include/Driver.i include/Dataset.i include/Band.i include/ColorTable.i include/cpl.i include/typemaps_php.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -php -outdir php -o $@ gdal.i 

php/gdalconst_php.c: include/gdalconst.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -php -outdir php -o $@ gdalconst.i

php/ogr_php.cpp:  include/ogr.i include/typemaps_php.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -outdir php -php -o $@ ogr.i 

php/osr_php.cpp:  include/osr.i include/typemaps_php.i
	$(SWIG) $(SWIGARGS) -Iinclude -I$(GDAL_ROOT) -c++ -outdir php -php -o $@ osr.i 

#
# We delegate the build and install processes to Python's distutils module
# through the setup.py script.  I don't understand how this will interact
# with libtool based builds.  It might have to be changed some in the future.

python_generate: $(PY_WRAPPERS)

python_build: $(PY_WRAPPERS)
	(cd python; $(PYTHON) setup.py build)

python_install: $(PY_WRAPPERS)
	(cd python; $(PYTHON) setup.py install --prefix=$(prefix))

#
# PHP
php_generate: $(PHP_WRAPPERS)

php_build: $(PHP_WRAPPERS)
	(cd php; make build)

php_install: $(PHP_WRAPPERS)
	(cd php; make install)
