GDAL_ROOT	=	../..

include ../../GDALmake.opt

SWIG = swig
SWIGARGS = -Wall

TYPEMAPDEPS = gdal_typemaps.i typemaps_csharp.i typemaps_python.i


PY_COMMANDS	=	epsg_tr.py gdalchksum.py gdal2xyz.py gcps2wld.py \
			gdalimport.py gdal_merge.py pct2rgb.py rgb2pct.py \
			gcps2vec.py
PY_MODULES	=	gdal.py ogr.py osr.py gdalconst.py
PY_WRAPPERS	= 	gdal_python.cpp gdalconst_python.c ogr_python.cpp osr_python.cpp

# The BINDINGS variable contains a list of the language bindings to be used
# in the default and install targets.  This could be moved to GDALmake.opt
# and generated by the configure script.
BINDINGS = python

.PHONY: python_build python_install

default: ${BINDINGS:%=%_build}

install: ${BINDINGS:%=%_install}

# The dist target should generate all the wrapper files for all supported
# language bindings.  This should be called by the top level distribution
# maker script prior to bundling up the source.  It eliminates the installer
# from having the proper version of swig installled.
dist: $(PY_WRAPPERS)

clean:
	$(RM) -r build

veryclean:
	-$(RM) -r build
	-$(RM) $(PY_WRAPPERS)
	-$(RM) $(PY_MODULES) $(PY_MODULES:%.py=%.pyc)

gdal_python.cpp: gdal.i Driver.i Dataset.i Band.i ColorTable.i cpl.i $(TYPEMAPDEPS)
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ gdal.i 

gdalconst_python.c: gdalconst.i
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -python -o $@ gdalconst.i

ogr_python.cpp:  ogr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ ogr.i 

osr_python.cpp:  osr.i ${TYPEMAPDEPS}
	$(SWIG) $(SWIGARGS) -I$(GDAL_ROOT) -c++ -python -o $@ osr.i 

#
# We delegate the build and install processes to Python's distutils module
# through the setup.py script.  I don't understand how this will interact
# with libtool based builds.  It might have to be changed some in the future.
python_build: $(PY_WRAPPERS)
	python setup.py build

python_install: $(PY_WRAPPERS)
	python setup.py install --prefix=$(prefix)

